\chapter{Методы оценивания декомпозиционной трудности булевых формул в применении к задачам тестирования и верификации логических схем}
\label{ch:decompositions}

ICCAD/SAT/IEEE article

\section{Общие стратегии декомпозиции булевых формул, кодирующих задачи верификации (проверки эквивалентности) логических схем}

\todo{Основной вывод: нужно объединять "входы" схем, чтобы уменьшить размерность пространства поиска, а также чтобы получить меньшую дисперсию подзадач.}

Для эффективного решения сложных экземпляров SAT часто разумно использовать некоторые техники разделения исходной проблемы на более простые.
% TODO: fix "partitioning" translation
Естественным способом декомпозиции экземпляра SAT на подзадачи является так называемый \textit{подход к разбиению} (\textit{partitioning approach})~\cite{hyvarinen2011}.

Рассмотрим произвольную КНФ-формулу~$C$ над множеством булевых переменных~$X$ и множество $\Pi = \{G_1, \dots, G_s\}$, где $G_i$, $i \in\nobreak \{1, \dots, s\}$, представляют собой некоторые булевы формулы над~$X$.
Пусть $\Pi$ задает \textit{разбиение SAT~$C$}, если выполняются следующие условия:
\begin{enumerate}
    \item формулы $C$ и $C \land (G_1 \lor \dots \lor G_s)$ равновыполнимы (\textit{equisatisfiable});
    \item для всех $i \neg j \in \{1, \dots, s\}$ формула $C \land G_i \land G_j$ выполнима.
\end{enumerate}

Здесь и далее будем называть конъюнкцию произвольных литералов (без эквивалентных и контрарных литералов) из~$X$ как \textit{куб} над~$X$.
Для произвольной КНФ~$C$ над переменными~$X$ простым примером разбиения является множество $\Pi = \{G_1, \dots, G_{2^r}\}$, которое состоит из всех возможных различных кубов размера~$r$ над множеством~$B$, где $|B| = r$.

\todo{Описать различные стратегии разбиения: по переменным (входы / (не-)балансные гейты), по кубам (CnC?), по чанкам (объединение входов), по интервалам.}


\section{Конструкции разбиения формул, кодирующих задачи верификации логических схем}

\todo{Чанки, балансные переменные, интервалы, математические свойства, детали программной реализации ("простая" реализация, BDD).}


% \section{Два новых построения SAT-разбиений для LEC}

Рассмотрим LEC для двух булевых схем $S_f$, $S_h$, определяющих функции $f, h \colon \{0,1\}^n \to \{0,1\}^m$.
Давайте сконструируем схему, полученную из $S_f$ и $S_h$ путем \enquote{склеивания} входных вершин (см.~\cref{fig:glued}), и обозначим ее через $S_{f \glue h}$.
Она имеет такое же $\Vin$, как и $S_f$ и $S_h$, и определяет следующую функцию:
\begin{equation}\label{eq:f-glue-h}
    f \glue h \colon \{0,1\}^n \to \{0,1\}^{2m}
\end{equation}
Обозначим $\Vout_f$ и $\Vout_h$ множества выходов схем $S_f$ и $S_h$, а также через $Y_f = \{y_1^f, \dots, y_m^f\}$ и $Y_h = \{y_1^h, \dots, y_m^h\}$ множества переменных, ассоциированных с вершинами из $\Vout_f$ и $\Vout_h$ соответственно, упорядоченные в соответствии с семантикой схем.
Теперь рассмотрим формулу $(y_1^f \xor y_1^h) \lor \dots \lor (y_m^f \xor y_m^h)$, которая определяет булеву функцию $\mathcal{M} \colon \{0, 1\}^{2m} \to \{0, 1\}$, называемую \emph{митером}.
Применим к этой формуле преобразования Цейтина и обозначим полученную КНФ как $C(\mathcal{M})$.
Прямо следует из \cref{lem1}, что схемы $S_f$ и $S_h$ эквивалентны тогда и только тогда, когда следующая КНФ-формула неудовлетворима:
\begin{equation}\label{eq:miter-cnf}
    C_{f \glue h} \land C(\mathcal{M}) ,
\end{equation}
где $C_{f \glue h}$ является шаблонной КНФ для функции~\eqref{eq:f-glue-h}.

\begin{figure}
    \begin{adjustbox}{max width=\linewidth}
        \subfile{tex/tikz-schemas}%
    \end{adjustbox}
    \caption{Склеенная схема $S_{f \glue h}$, построенная с использованием одного и того же набора входов для двух схем $S_f$ и $S_h$}
    \label{fig:glued}
\end{figure}

Далее приведены две различные конструкции для эффективного построения SAT-разбиений для произвольного экземпляра задачи LEC.
Первую конструкцию определим следующим образом:
\begin{construction}\label{con1}
    Рассмотрим множество переменных $\Xin = \{x_1, \dots, x_n\}$, ассоциированных с входами схем $S_f, S_h, S_{f \glue h}$.
    Затем выберем целое число~$k$ так, что $1 < k < n$, и разобьем~$\Xin$ на~$q = \lceil n / k \rceil$ попарно непересекающихся множеств~$X^j$, где $j \in \{1, \dots, q\}$.
    Если $n$ делится на~$k$, то каждое множество~$X^j$ содержит $k$ переменных.
    В противном случае разобьем~$\Xin$ на $q-1$ множеств $X^1, \dots, X^{q-1}$ размером~$k$ каждое и одно множество~$X^q$ размером~$r$, такое что $n = k \cdot \lfloor \frac{n}{k} \rfloor + r$, где $r \in \{1, \dots, k-1\}$.
\end{construction}

Рассмотрим произвольную булеву функцию $\lambda \colon \{0,1\}^l \to \{0,1\}$, где~$l \in \Natural^{+}$, и предположим, что $\lambda$ не является константой.
Пусть $\neg\lambda \colon \{0,1\}^l \to \{0,1\}$ обозначает отрицание~$\lambda$.
С каждым~$X^j$, $j \in \{1, \dots, q\}$, свяжем две КНФ-формулы $\phi_1^j$ и $\phi_2^j$, которые определяют функции $\lambda^j \colon \{0,1\}^{|X^j|} \to \{0,1\}$ и $\neg\lambda^j \colon \{0,1\}^{|X^j|} \to \{0,1\}$ соответственно.

\begin{theorem}\label{thm:partitioning-input-decomposition}
    Пусть $\phi^j$ обозначает обе формулы $\phi^j_1$ и $\phi^j_2$.
    Множество~$\Pi$ всех $2^{\lceil n/k \rceil}$ возможных формул вида $\phi^1 \land \dots \land \phi^{\lceil n/k \rceil}$ формирует SAT-разбиение формулы~\eqref{eq:miter-cnf}.
\end{theorem}

\begin{proof}[Набросок доказательства]
    В доказательстве мы можем использовать \cref{lem1}, чтобы показать, что любое присваивание, удовлетворяющее $C_{f \Delta h}$, также удовлетворяет ровно одной формуле вида $G_i \land C_{f \Delta h}$, где $G_i$, $i\in \{1,\dots,2^{\lceil n/k \rceil} \}$, является конкретным примером формулы $\phi^1 \land \dots \land \phi^{\lceil n/k \rceil}$ для определенных $\phi_l^j$, $l \in \{1,2\}$, $j \in \{1, \dots, 2^{\lceil n/k \rceil}\}$.
    Таким образом, формулы $C_{f \glue h} \land C(\mathcal{M})$ и $C_{f \glue h} \land C(\mathcal{M}) \land (G_1 \lor \dots \lor G_{2^{\lceil n/k \rceil}})$ равновыполнимы.
\end{proof}

Важным вопросом является выбор функций $\lambda^j$ и $\neg\lambda^j$ таким образом, чтобы гарантировать малую дисперсию $\fun{Var}(\xi_\Pi)$ для SAT-разбиения $\Pi$ описанного выше типа.
Здравый смысл подсказывает, что \emph{сбалансированная} булева функция, которая принимает значение 1 на $2^{l-1}$ входных словах, должна использоваться в качестве функции $\lambda \colon \{0,1\}^l \to \{0,1\}$.
Очевидно, что если $\lambda$ является сбалансированной функцией, то ее отрицание $\neg\lambda$ также является сбалансированной.
Хорошим примером сбалансированной функции для $l > 1$ является функция, заданная формулой $x_1 \xor \dots \xor x_l$.

В данной статье мы представляем немного неформальный анализ свойств \cref{con1} и используем его в качестве основы для \cref{con2}, которая показала лучшие результаты среди всех рассматриваемых методов в экспериментах с некоторыми чрезвычайно сложными экземплярами LEC в SAT-форме.
Рассмотрим функцию~\eqref{eq:f-glue-h} и шаблонную КНФ~$C_{f \glue h}$.
Множество экспериментов показывает, что даже когда SAT для $C_{f \glue h} \land C(\mathcal{M})$ является крайне сложным, SAT для $C_{f \glue h}$ остается простым: любой SAT-солвер на основе CDCL, получивший на вход $C_{f \glue h}$ без дополнительной информации о структуре схемы, умеет находить удовлетворяющее присваивание для $C_{f \glue h}$.
Это присваивание можно рассматривать как удовлетворяющий сертификат для $C_{f \glue h}$.
Как было отмечено выше, КНФ $C_{f\Delta h}$ имеет $2^n$ таких сертификатов.
Следовательно, доказательство неудовлетворимости $C_{f \glue h} \land C(\mathcal{M})$ можно рассматривать как процесс, который аннулирует все эти сертификаты.
Более того, если функции $\lambda^j$ сбалансированы для каждого $j \in \{1, \dots, \lceil n/k \rceil\}$, то каждая формула вида $\phi^1 \land \dots \land \phi^{\lceil n/k \rceil} \land C_{f \glue h}$ имеет $2^{n-\lceil n/k \rceil}$ удовлетворяющих присваиваний, которые также являются сертификатами удовлетворимости.
Таким образом, можно сделать два спекулятивных предположения:
\begin{enumerate}
    \item Для алгоритма $A$ намного проще доказать неудовлетворимость формулы $\phi^1 \land \dots \land \phi^{\lceil n/k \rceil} \land C_{f \glue h} \land C(\mathcal{M})$, потому что ему необходимо аннулировать $2^{n-\lceil n/k \rceil}$ сертификатов вместо $2^n$.
    \item Для сбалансированных функций $\lambda^{j}$, $j \in \{1, \dots, \lceil n/k \rceil\}$, все $2^{\lceil n/k \rceil}$ различных формул вида $\phi^1 \land \dots \land \phi^{\lceil n/k \rceil} \land C_{f \glue h} \land C(\mathcal{M})$ должны быть более или менее схожими по времени выполнения алгоритма $A$ на них, т.е. разбиение $\Pi$, заданное \cref{con1}, должно иметь малую дисперсию $\fun{Var}(\xi_{\Pi})$.
\end{enumerate}

Хотя представленные аргументы лишены строго формального доказательства, их выводы были экспериментально проверены.
Ниже мы опишем еще одну конструкцию, при разработке которой мы учитывали вышеуказанные свойства.

Основная идея описанной ниже конструкции заключается в том, чтобы рассмотреть произвольное присваивание переменных из $\Xin =\{x_1,\ldots,x_n\}$ как коэффициенты двоичного представления числа из $N_{0}^{n} = \{0,1,\ldots,2^n-1\}$.
Таким образом, существует взаимно однозначное соответствие $\{0,1\}^n \to N_{0}^{n}$.
Для произвольных $a,b \in N_{0}^{n}$ назовем множество чисел $\Set{ q \in N_{0}^{n} \given a \leq q \leq b }$ \textit{интервалом} и обозначим такой интервал как~$[a,b]$.
Рассмотрим множество булевых векторов из $\{0,1\}^n$, которые являются двоичными представлениями чисел из~$[a,b]$, как множество решений следующего целочисленного неравенства, предполагая, что $x_i$, $i \in \{1,\dots,n\}$ принимают значения из~$\{0,1\}$:
\begin{equation}\label{eq-ineq}
    a \leq x_1 + 2\cdot x_2 + \dots + 2^{n-1} \cdot x_n \leq b
\end{equation}
Пусть множество $\mathcal{R}^n$ состоит из интервалов описанного вида и является \textit{полной системой интервалов}, если ни один из двух интервалов из $\mathcal{R}^n$ не пересекаются и любое число из $N_{0}^{n}$ принадлежит какому-либо интервалу в $\mathcal{R}^n$.
Это означает, что любая полная система интервалов индуцирует разбиение $\{0,1\}^n$ на непересекающиеся подмножества, образованные решениями соответствующих неравенств \eqref{eq-ineq}.

\begin{construction}\label{con2}
    Пусть $\mathcal{R}^n$ будет полной системой интервалов.
    С произвольным $I \in \mathcal{R}^n$, $I = [a,b]$, свяжем неравенство вида~\eqref{eq-ineq} и КНФ~$C_I$, полученную путем преобразования~\eqref{eq-ineq} в SAT с использованием соответствующих техник, таких как те, которые описаны в \cite{een2006}.
    Определим $\Pi = \{C_I\}_{I \in \mathcal{R}^n}$.
\end{construction}
\begin{theorem}\label{thm3}
    Множество $\Pi = \{C_I\}_{I\in \mathcal{R}^n}$, полученное с использованием \cref{con2}, формирует SAT-разбиение формулы $C_{f\Delta h} \land C(\mathcal{M})$.
\end{theorem}


\section{Вероятностный и статистический анализ свойств предложенных разбиений}

\todo{Статистические оценки, результаты из IEEE, доверительные интервалы, обоснование мощности выборки}


\section{Экспериментальное исследование}

\todo{Вычислительные эксперименты и их результаты}

\todo{Multipliers, Sorters, Cryptography}
